<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DSST | Kenetik Brain Score</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rokkitt:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    /* Reset */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }
    /* museo-slab fallback: use Rokkitt from Google Fonts */
    @font-face {
      font-family: 'museo-slab';
      src: local('Rokkitt');
      font-weight: 300;
      font-style: normal;
    }
    @font-face {
      font-family: 'museo-slab';
      src: local('Rokkitt');
      font-weight: 500;
      font-style: normal;
    }

    /* Kenetik Brain Score - DSST (Digit Symbol Substitution Test) */
    /* Imports shared brain-score base styles from stroop CSS */
    /* Brand: White background, black text, Avenir body, museo-slab headings */
    /* Accent gradient: #E84B63 to #F4B341, pill buttons */
    
    /* ===== BASE (shared with Stroop) ===== */
    
    .brain-score {
      background: #ffffff;
      color: #000000;
      font-family: "Avenir", sans-serif;
      padding: 80px 0 60px;
      min-height: 100vh;
    }
    
    .brain-score__container {
      max-width: 680px;
      margin: 0 auto;
      padding: 0 24px;
      width: 100%;
      text-align: center;
    }
    
    .brain-score__intro {
      max-width: 560px;
      margin: 0 auto;
    }
    
    .brain-score__eyebrow {
      font-family: "Avenir", sans-serif;
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 2.5px;
      text-transform: uppercase;
      color: #E84B63;
      margin-bottom: 16px;
    }
    
    .brain-score__title {
      font-family: "museo-slab", serif;
      font-size: 42px;
      font-weight: 500;
      line-height: 1.19;
      margin-bottom: 20px;
      color: #000000;
    }
    
    .brain-score__subtitle {
      font-family: "Avenir", sans-serif;
      font-size: 17px;
      font-weight: 400;
      line-height: 1.6;
      color: #555555;
      margin-bottom: 40px;
    }
    
    .brain-score__how-it-works {
      text-align: left;
      background: #f7f7f7;
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 40px;
    }
    
    .brain-score__how-title {
      font-family: "Avenir", sans-serif;
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: #999999;
      margin-bottom: 20px;
    }
    
    .brain-score__step {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 16px;
    }
    
    .brain-score__step:last-child {
      margin-bottom: 0;
    }
    
    .brain-score__step-num {
      font-family: "Avenir", sans-serif;
      font-size: 13px;
      font-weight: 800;
      color: #ffffff;
      background: #000000;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-top: 1px;
    }
    
    .brain-score__step-text {
      font-size: 15px;
      font-weight: 400;
      line-height: 1.5;
      color: #333333;
    }
    
    /* Welcome Back Banner (Fix 2: Returning users) */
    .brain-score__welcome-back {
      background: linear-gradient(135deg, rgba(232, 75, 99, 0.06) 0%, rgba(244, 179, 65, 0.06) 100%);
      border: 1px solid rgba(232, 75, 99, 0.15);
      border-radius: 12px;
      padding: 20px 24px;
      margin-bottom: 32px;
      text-align: center;
    }
    
    .brain-score__welcome-text {
      font-size: 15px;
      font-weight: 500;
      color: #333333;
      line-height: 1.5;
      margin-bottom: 8px;
    }
    
    .brain-score__welcome-clear {
      font-size: 13px;
      color: #999999;
      background: none;
      border: none;
      cursor: pointer;
      font-family: "Avenir", sans-serif;
      font-weight: 500;
      padding: 0;
      text-decoration: underline;
      transition: color 0.2s ease;
    }
    
    .brain-score__welcome-clear:hover {
      color: #E84B63;
    }
    
    /* Form Styles */
    .brain-score__form {
      text-align: left;
      margin-bottom: 32px;
    }
    
    .brain-score__field {
      margin-bottom: 20px;
    }
    
    .brain-score__label {
      display: block;
      font-family: "Avenir", sans-serif;
      font-size: 13px;
      font-weight: 800;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #999999;
      margin-bottom: 8px;
    }
    
    .brain-score__label--optional {
      color: #bbbbbb;
      text-transform: none;
      letter-spacing: 0;
      font-size: 12px;
      font-weight: 400;
    }
    
    .brain-score__input {
      width: 100%;
      padding: 14px 16px;
      background: #ffffff;
      border: 1px solid #dddddd;
      border-radius: 100px;
      color: #000000;
      font-size: 16px;
      font-family: "Avenir", sans-serif;
      font-weight: 400;
      transition: border-color 0.2s ease;
      box-sizing: border-box;
    }
    
    .brain-score__input:focus {
      outline: none;
      border-color: #E84B63;
    }
    
    .brain-score__input::placeholder {
      color: #bbbbbb;
    }
    
    /* Select Dropdown (Fix 7: Age brackets) */
    .brain-score__select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23999' stroke-width='1.5' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      padding-right: 40px;
      cursor: pointer;
    }
    
    .brain-score__select:invalid,
    .brain-score__select option[value=""] {
      color: #bbbbbb;
    }
    
    .brain-score__select option {
      color: #000000;
    }
    
    /* Use Case Selection */
    .brain-score__use-cases {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .brain-score__use-case {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: #ffffff;
      border: 1px solid #dddddd;
      border-radius: 100px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .brain-score__use-case:hover {
      border-color: #999999;
    }
    
    .brain-score__use-case.selected {
      border-color: #E84B63;
      background: #fff8f8;
    }
    
    .brain-score__use-case input[type="radio"] {
      display: none;
    }
    
    .brain-score__radio-circle {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid #dddddd;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.2s ease;
    }
    
    .brain-score__use-case.selected .brain-score__radio-circle {
      border-color: #E84B63;
    }
    
    .brain-score__radio-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #E84B63;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    .brain-score__use-case.selected .brain-score__radio-dot {
      opacity: 1;
    }
    
    .brain-score__use-case-label {
      font-size: 15px;
      font-weight: 500;
      color: #333333;
      line-height: 1.4;
    }
    
    .brain-score__use-case.selected .brain-score__use-case-label {
      color: #000000;
    }
    
    /* Other Write-in Input (Fix 6) */
    .brain-score__other-input {
      margin-top: 8px;
      padding-left: 48px;
    }
    
    /* Primary Button */
    .brain-score__btn {
      display: inline-block;
      position: relative;
      background: linear-gradient(90deg, #E84B63 0%, #F4B341 100%);
      border-radius: 100px;
      overflow: hidden;
      padding: 2px;
      border: none;
      cursor: pointer;
      font-family: "Avenir", sans-serif;
      transition: all 0.3s ease;
      text-decoration: none;
    }
    
    .brain-score__btn span {
      display: inline-block;
      width: 100%;
      height: 100%;
      padding: 14px 48px;
      border-radius: 100px;
      background: #000000;
      color: #ffffff;
      font-size: 16px;
      font-weight: 800;
      font-family: "Avenir", sans-serif;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
    }
    
    .brain-score__btn:hover span {
      background: transparent;
      color: #ffffff;
    }
    
    .brain-score__btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    
    .brain-score__btn:disabled:hover span {
      background: #000000;
    }
    
    .brain-score__btn--secondary span {
      background: #ffffff;
      color: #000000;
    }
    
    .brain-score__btn--secondary:hover span {
      background: transparent;
      color: #ffffff;
    }
    
    /* Buy Kenetik CTA Button (Fix 8) */
    .brain-score__buy-cta {
      margin-bottom: 24px;
    }
    
    .brain-score__btn--buy {
      width: 100%;
      max-width: 320px;
    }
    
    .brain-score__btn--buy span {
      background: transparent;
      color: #ffffff;
    }
    
    .brain-score__btn--buy:hover span {
      background: rgba(0, 0, 0, 0.15);
      color: #ffffff;
    }
    
    /* Test Navigation Links (Fix 3) */
    .brain-score__test-nav {
      margin-top: 24px;
      margin-bottom: 8px;
    }
    
    .brain-score__test-nav-link {
      font-size: 14px;
      font-weight: 500;
      color: #999999;
      text-decoration: none;
      transition: color 0.2s ease;
      font-family: "Avenir", sans-serif;
    }
    
    .brain-score__test-nav-link:hover {
      color: #E84B63;
    }
    
    /* ===== DSST-SPECIFIC STYLES ===== */
    
    .dsst__test {
      position: relative;
    }
    
    /* Header: timer + live score */
    .dsst__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }
    
    .dsst__timer-wrap,
    .dsst__score-live {
      display: flex;
      align-items: baseline;
      gap: 8px;
    }
    
    .dsst__timer-label,
    .dsst__score-live-label {
      font-size: 11px;
      font-weight: 800;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: #999999;
    }
    
    .dsst__timer {
      font-family: "museo-slab", serif;
      font-size: 32px;
      font-weight: 500;
      color: #000000;
      min-width: 48px;
      text-align: center;
      transition: color 0.3s ease;
    }
    
    .dsst__timer--urgent {
      color: #E84B63;
    }
    
    .dsst__score-live-num {
      font-family: "museo-slab", serif;
      font-size: 32px;
      font-weight: 500;
      color: #000000;
    }
    
    /* Reference Key (Fix 4: tightened margin from 40px to 24px) */
    .dsst__key {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 1px;
      background: #eeeeee;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 24px;
    }
    
    .dsst__key-pair {
      background: #f7f7f7;
      padding: 12px 4px;
      text-align: center;
    }
    
    .dsst__key-digit {
      font-family: "museo-slab", serif;
      font-size: 18px;
      font-weight: 500;
      color: #000000;
      margin-bottom: 6px;
    }
    
    .dsst__key-symbol {
      font-size: 22px;
      line-height: 1;
      color: #E84B63;
    }
    
    /* Current Digit Prompt (Fix 4: tightened margin from 32px to 20px) */
    .dsst__prompt {
      margin-bottom: 20px;
    }
    
    .dsst__prompt-label {
      font-size: 14px;
      font-weight: 500;
      color: #999999;
      margin-bottom: 8px;
    }
    
    .dsst__prompt-digit {
      font-family: "museo-slab", serif;
      font-size: 80px;
      font-weight: 300;
      line-height: 1;
      background: linear-gradient(90deg, #E84B63 0%, #F4B341 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* Symbol Response Grid */
    .dsst__responses {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .dsst__response-btn {
      padding: 16px 4px;
      font-size: 24px;
      line-height: 1;
      background: #ffffff;
      border: 2px solid #eeeeee;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.15s ease;
      font-family: inherit;
      color: #333333;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      -webkit-user-select: none;
    }
    
    .dsst__response-btn:hover {
      border-color: #E84B63;
      background: #fff8f8;
    }
    
    .dsst__response-btn:active {
      transform: scale(0.95);
      background: #E84B63;
      color: #ffffff;
      border-color: #E84B63;
    }
    
    /* Timer Progress Bar */
    .dsst__timer-bar {
      height: 4px;
      background: #eeeeee;
      border-radius: 2px;
      margin-top: 24px;
      overflow: hidden;
    }
    
    .dsst__timer-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #E84B63 0%, #F4B341 100%);
      border-radius: 2px;
      transition: width 1s linear;
    }
    
    /* Feedback */
    .brain-score__feedback {
      font-size: 14px;
      font-weight: 800;
      height: 20px;
      margin-top: 8px;
      transition: opacity 0.2s ease;
    }
    
    .brain-score__feedback--correct {
      color: #2d9d4e;
    }
    
    .brain-score__feedback--incorrect {
      color: #E84B63;
    }
    
    /* Results */
    .brain-score__results {
      max-width: 560px;
      margin: 0 auto;
    }
    
    .brain-score__score-display {
      margin-bottom: 40px;
    }
    
    .brain-score__score-number {
      font-family: "museo-slab", serif;
      font-size: 96px;
      font-weight: 300;
      line-height: 1;
      margin-bottom: 8px;
      background: linear-gradient(90deg, #E84B63 0%, #F4B341 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .brain-score__score-label {
      font-size: 13px;
      font-weight: 800;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #999999;
    }
    
    .brain-score__metrics {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1px;
      background: #eeeeee;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 24px;
    }
    
    .brain-score__metric {
      background: #f7f7f7;
      padding: 24px 16px;
      text-align: center;
    }
    
    .brain-score__metric-value {
      font-family: "museo-slab", serif;
      font-size: 28px;
      font-weight: 500;
      margin-bottom: 6px;
      color: #000000;
    }
    
    .brain-score__metric-label {
      font-size: 11px;
      font-weight: 800;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: #999999;
    }
    
    /* Performance Bar */
    .brain-score__perf-bar-wrap {
      margin-bottom: 32px;
      text-align: left;
    }
    
    .brain-score__perf-bar-title {
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: #999999;
      margin-bottom: 12px;
      text-align: center;
    }
    
    .brain-score__perf-bar {
      height: 8px;
      background: #eeeeee;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }
    
    .brain-score__perf-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #E84B63 0%, #F4B341 100%);
      border-radius: 4px;
      transition: width 1s ease;
    }
    
    .brain-score__perf-bar-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 6px;
      font-size: 10px;
      font-weight: 500;
      color: #bbbbbb;
    }
    
    /* Score History Chart */
    .brain-score__history {
      background: #f7f7f7;
      border-radius: 12px;
      padding: 28px 32px;
      margin-bottom: 32px;
      text-align: center;
    }
    
    .brain-score__history-title {
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: #999999;
      margin-bottom: 24px;
    }
    
    .brain-score__history-chart {
      position: relative;
      height: 120px;
      margin: 0 20px 8px;
    }
    
    .brain-score__history-svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 120px;
      overflow: visible;
    }
    
    .brain-score__history-dot {
      position: absolute;
      width: 10px;
      height: 10px;
      background: #E84B63;
      border: 2px solid #ffffff;
      border-radius: 50%;
      transform: translate(-50%, 50%);
      z-index: 2;
      cursor: default;
    }
    
    .brain-score__history-dot:last-of-type {
      background: linear-gradient(135deg, #E84B63, #F4B341);
      width: 14px;
      height: 14px;
      border-width: 3px;
    }
    
    .brain-score__history-dot-score {
      position: absolute;
      bottom: calc(100% + 6px);
      left: 50%;
      transform: translateX(-50%);
      font-family: "museo-slab", serif;
      font-size: 13px;
      font-weight: 500;
      color: #000000;
      white-space: nowrap;
    }
    
    .brain-score__history-labels {
      position: relative;
      height: 20px;
      margin: 0 20px 16px;
    }
    
    .brain-score__history-date {
      position: absolute;
      transform: translateX(-50%);
      font-size: 10px;
      font-weight: 500;
      color: #bbbbbb;
      white-space: nowrap;
    }
    
    .brain-score__history-summary {
      font-size: 14px;
      font-weight: 400;
      color: #555555;
      line-height: 1.5;
      text-align: left;
    }
    
    /* Insight Box */
    .brain-score__insight {
      background: #f7f7f7;
      border-radius: 12px;
      padding: 28px 32px;
      margin-bottom: 32px;
      text-align: left;
    }
    
    .brain-score__insight-title {
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: #999999;
      margin-bottom: 12px;
    }
    
    .brain-score__insight-text {
      font-size: 16px;
      font-weight: 400;
      line-height: 1.6;
      color: #333333;
    }
    
    /* Science Fact Card */
    .brain-score__science-fact {
      background: linear-gradient(135deg, rgba(232, 75, 99, 0.06) 0%, rgba(244, 179, 65, 0.06) 100%);
      border: 1px solid rgba(232, 75, 99, 0.15);
      border-radius: 12px;
      padding: 28px 32px;
      margin-bottom: 32px;
      text-align: left;
    }
    
    .brain-score__science-fact-eyebrow {
      font-size: 11px;
      font-weight: 800;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      background: linear-gradient(90deg, #E84B63, #F4B341);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 12px;
    }
    
    .brain-score__science-fact-text {
      font-size: 15px;
      font-weight: 400;
      line-height: 1.65;
      color: #333333;
      margin-bottom: 16px;
    }
    
    .brain-score__science-fact-link {
      font-size: 14px;
      font-weight: 600;
      color: #E84B63;
      text-decoration: none;
      transition: color 0.2s;
    }
    
    .brain-score__science-fact-link:hover {
      color: #F4B341;
    }
    
    .brain-score__results-actions {
      display: flex;
      gap: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    /* Retest opt-in */
    .brain-score__retest-opt-in {
      background: #f7f7f7;
      border-radius: 12px;
      padding: 24px 32px;
      margin-bottom: 32px;
      text-align: left;
    }
    
    .brain-score__retest-text {
      font-size: 15px;
      font-weight: 400;
      color: #555555;
      line-height: 1.5;
    }
    
    /* Screen transitions */
    .brain-score__screen {
      display: none;
      animation: brainScoreFadeIn 0.4s ease;
    }
    
    .brain-score__screen--active {
      display: block;
    }
    
    @keyframes brainScoreFadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Countdown */
    .brain-score__countdown {
      font-family: "museo-slab", serif;
      font-size: 72px;
      font-weight: 300;
      color: #000000;
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .brain-score__instruction {
      font-size: 16px;
      font-weight: 500;
      color: #777777;
      margin-bottom: 48px;
      line-height: 1.5;
    }
    
    /* ===== RESPONSIVE ===== */
    @media (max-width: 767px) {
      .brain-score {
        padding: 40px 0;
      }
    
      .brain-score__title {
        font-size: 32px;
      }
    
      .dsst__key {
        grid-template-columns: repeat(5, 1fr);
        border-radius: 10px;
      }
    
      .dsst__key-digit {
        font-size: 15px;
      }
    
      .dsst__key-symbol {
        font-size: 18px;
      }
    
      .dsst__prompt-digit {
        font-size: 56px;
      }
    
      .dsst__responses {
        grid-template-columns: repeat(5, 1fr);
        gap: 6px;
      }
    
      .dsst__response-btn {
        padding: 14px 4px;
        font-size: 20px;
        border-radius: 10px;
      }
    
      .brain-score__metrics {
        grid-template-columns: 1fr;
      }
    
      .brain-score__score-number {
        font-size: 72px;
      }
    
      .brain-score__how-it-works {
        padding: 24px;
      }
    
      .brain-score__results-actions {
        flex-direction: column;
      }
    
      .brain-score__btn {
        width: 100%;
      }
    
      .brain-score__btn--buy {
        max-width: 100%;
      }
    
      .brain-score__other-input {
        padding-left: 0;
      }
    
      .brain-score__history {
        padding: 20px 16px;
      }
    
      .brain-score__history-chart {
        margin: 0 10px 8px;
        height: 100px;
      }
    
      .brain-score__history-svg {
        height: 100px;
      }
    
      .brain-score__history-labels {
        margin: 0 10px 12px;
      }
    }
    
    @media (max-width: 480px) {
      .dsst__key {
        grid-template-columns: repeat(3, 1fr);
      }
    
      .dsst__responses {
        grid-template-columns: repeat(3, 1fr);
      }
    }
  </style>
  <!-- Klaviyo (preview placeholder) -->
  <script async src="https://static.klaviyo.com/onsite/js/klaviyo.js?company_id=PLACEHOLDER_KEY"></script>
  <script>var _learnq = window._learnq || [];</script>
</head>
<body>
<section class="brain-score" id="brain-score-dsst">
  <div class="brain-score__container">

    <!-- SCREEN 1: Intro + Lead Capture -->
    <div class="brain-score__screen brain-score__screen--active" id="dsst-intro">
      <div class="brain-score__intro">
        <div class="brain-score__eyebrow">Kenetik Brain Score</div>
        <h1 class="brain-score__title">How fast does your brain process?</h1>
        <p class="brain-score__subtitle">The Digit Symbol test measures processing speed and working memory. The same cognitive functions that decline first with fatigue and improve with sustained ketone metabolism.</p>

        <div class="brain-score__how-it-works">
          <div class="brain-score__how-title">How it works</div>
          <div class="brain-score__step">
            <div class="brain-score__step-num">1</div>
            <div class="brain-score__step-text">A reference key pairs each digit (1 through 9) with a unique symbol. This key stays visible the entire time.</div>
          </div>
          <div class="brain-score__step">
            <div class="brain-score__step-num">2</div>
            <div class="brain-score__step-text">You'll see a digit appear. Match it to the correct symbol as fast as you can. 90 seconds on the clock.</div>
          </div>
          <div class="brain-score__step">
            <div class="brain-score__step-num">3</div>
            <div class="brain-score__step-text">Your score reflects how many you get right, how fast you respond, and how consistent you are under time pressure.</div>
          </div>
        </div>

        <!-- Welcome Back Banner -->
        <div class="brain-score__welcome-back" id="dsst-welcome-back" style="display: none;">
          <p class="brain-score__welcome-text">Welcome back, <span id="dsst-welcome-name"></span>. Your info is saved.</p>
          <button class="brain-score__welcome-clear" id="dsst-clear-user" type="button">Not you? Start fresh</button>
        </div>

        <form class="brain-score__form" id="dsst-form" onsubmit="return false;">
          <div class="brain-score__field">
            <label class="brain-score__label" for="dsst-name">First Name</label>
            <input class="brain-score__input" type="text" id="dsst-name" name="name" placeholder="Your first name" required autocomplete="given-name">
          </div>
          <div class="brain-score__field">
            <label class="brain-score__label" for="dsst-email">Email</label>
            <input class="brain-score__input" type="email" id="dsst-email" name="email" placeholder="you@example.com" required autocomplete="email">
          </div>
          <div class="brain-score__field">
            <label class="brain-score__label" for="dsst-phone">
              Phone
              <span class="brain-score__label--optional">(optional, for retest reminders)</span>
            </label>
            <input class="brain-score__input" type="tel" id="dsst-phone" name="phone" placeholder="(555) 555-5555" autocomplete="tel">
          </div>
          <div class="brain-score__field">
            <label class="brain-score__label">What brings you to Kenetik?</label>
            <div class="brain-score__use-cases" id="dsst-use-cases">
              <label class="brain-score__use-case" data-value="cognitive-performance">
                <input type="radio" name="use_case" value="cognitive-performance">
                <span class="brain-score__radio-circle"><span class="brain-score__radio-dot"></span></span>
                <span class="brain-score__use-case-label">Focus and cognitive performance</span>
              </label>
              <label class="brain-score__use-case" data-value="athletic-performance">
                <input type="radio" name="use_case" value="athletic-performance">
                <span class="brain-score__radio-circle"><span class="brain-score__radio-dot"></span></span>
                <span class="brain-score__use-case-label">Athletic performance and recovery</span>
              </label>
              <label class="brain-score__use-case" data-value="brain-health">
                <input type="radio" name="use_case" value="brain-health">
                <span class="brain-score__radio-circle"><span class="brain-score__radio-dot"></span></span>
                <span class="brain-score__use-case-label">Long-term brain health and cognitive protection</span>
              </label>
              <label class="brain-score__use-case" data-value="stimulant-free">
                <input type="radio" name="use_case" value="stimulant-free">
                <span class="brain-score__radio-circle"><span class="brain-score__radio-dot"></span></span>
                <span class="brain-score__use-case-label">A clean alternative to caffeine and stimulants</span>
              </label>
              <label class="brain-score__use-case" data-value="other">
                <input type="radio" name="use_case" value="other">
                <span class="brain-score__radio-circle"><span class="brain-score__radio-dot"></span></span>
                <span class="brain-score__use-case-label">Other</span>
              </label>
            </div>
            <div class="brain-score__other-input" id="dsst-other-wrap" style="display: none;">
              <input class="brain-score__input" type="text" id="dsst-other-text" placeholder="Tell us what brings you here..." maxlength="100">
            </div>
          </div>
          <div class="brain-score__field">
            <label class="brain-score__label" for="dsst-age">Age Range</label>
            <select class="brain-score__input brain-score__select" id="dsst-age" required>
              <option value="" disabled selected>Select your age range</option>
              <option value="18-25">18 to 25</option>
              <option value="26-35">26 to 35</option>
              <option value="36-45">36 to 45</option>
              <option value="46-55">46 to 55</option>
              <option value="56-65">56 to 65</option>
              <option value="65+">65+</option>
              <option value="prefer-not-to-say">Prefer not to say</option>
            </select>
          </div>
          <button class="brain-score__btn" id="dsst-start-btn" type="button" disabled><span>Start the Test</span></button>
        </form>

        <div class="brain-score__test-nav">
          <a class="brain-score__test-nav-link" href="stroop.html">Or try the Stroop Color Test &rarr;</a>
        </div>
      </div>
    </div>

    <!-- SCREEN 2: Countdown -->
    <div class="brain-score__screen" id="dsst-countdown">
      <div class="brain-score__eyebrow">Get Ready</div>
      <p class="brain-score__instruction">Match each digit to its symbol. Go as fast as you can.</p>
      <div class="brain-score__countdown" id="dsst-countdown-num">3</div>
    </div>

    <!-- SCREEN 3: Active Test -->
    <div class="brain-score__screen" id="dsst-test">
      <div class="dsst__test">
        <!-- Timer + Progress -->
        <div class="dsst__header">
          <div class="dsst__timer-wrap">
            <span class="dsst__timer-label">Time</span>
            <span class="dsst__timer" id="dsst-timer">90</span>
          </div>
          <div class="dsst__score-live">
            <span class="dsst__score-live-label">Correct</span>
            <span class="dsst__score-live-num" id="dsst-live-score">0</span>
          </div>
        </div>

        <!-- Reference Key -->
        <div class="dsst__key" id="dsst-key"></div>

        <!-- Current Digit Prompt -->
        <div class="dsst__prompt">
          <div class="dsst__prompt-label">Match this digit:</div>
          <div class="dsst__prompt-digit" id="dsst-prompt-digit">?</div>
        </div>

        <!-- Symbol Response Grid -->
        <div class="dsst__responses" id="dsst-responses"></div>

        <div class="brain-score__feedback" id="dsst-feedback">&nbsp;</div>

        <!-- Timer Progress Bar -->
        <div class="dsst__timer-bar">
          <div class="dsst__timer-bar-fill" id="dsst-timer-fill" style="width: 100%"></div>
        </div>
      </div>
    </div>

    <!-- SCREEN 4: Results -->
    <div class="brain-score__screen" id="dsst-results">
      <div class="brain-score__results">
        <div class="brain-score__eyebrow">Your Brain Score</div>

        <div class="brain-score__score-display">
          <div class="brain-score__score-number" id="dsst-score">--</div>
          <div class="brain-score__score-label">out of 100</div>
        </div>

        <div class="brain-score__metrics">
          <div class="brain-score__metric">
            <div class="brain-score__metric-value" id="dsst-completed">--</div>
            <div class="brain-score__metric-label">Completed</div>
          </div>
          <div class="brain-score__metric">
            <div class="brain-score__metric-value" id="dsst-accuracy">--%</div>
            <div class="brain-score__metric-label">Accuracy</div>
          </div>
          <div class="brain-score__metric">
            <div class="brain-score__metric-value" id="dsst-avg-time">--ms</div>
            <div class="brain-score__metric-label">Avg Speed</div>
          </div>
        </div>

        <!-- Performance Bar -->
        <div class="brain-score__perf-bar-wrap" id="dsst-perf-bar-wrap">
          <div class="brain-score__perf-bar-title">Your Performance</div>
          <div class="brain-score__perf-bar">
            <div class="brain-score__perf-bar-fill" id="dsst-perf-fill" style="width: 0%"></div>
          </div>
          <div class="brain-score__perf-bar-labels">
            <span>Needs Work</span>
            <span>Average</span>
            <span>Excellent</span>
          </div>
        </div>

        <!-- Score History -->
        <div class="brain-score__history" id="dsst-history" style="display: none;">
          <div class="brain-score__history-title">Your Score History</div>
          <div class="brain-score__history-chart" id="dsst-history-chart"></div>
          <div class="brain-score__history-labels" id="dsst-history-labels"></div>
          <div class="brain-score__history-summary" id="dsst-history-summary"></div>
        </div>

        <div class="brain-score__insight" id="dsst-insight">
          <div class="brain-score__insight-title">What this means</div>
          <p class="brain-score__insight-text" id="dsst-insight-text">Your results are loading...</p>
        </div>

        <!-- Brain Science Fact -->
        <div class="brain-score__science-fact" id="dsst-science-fact">
          <div class="brain-score__science-fact-eyebrow">The Science</div>
          <p class="brain-score__science-fact-text" id="dsst-science-fact-text"></p>
          <a class="brain-score__science-fact-link" href="https://drinkkenetik.com/pages/science" id="dsst-science-link">Explore the research</a>
        </div>

        <div class="brain-score__retest-opt-in" id="dsst-retest-section" style="display: none;">
          <p class="brain-score__retest-text">
            Processing speed is one of the first cognitive functions affected by fatigue and one of the most responsive to sustained ketone availability. Track yours monthly.
          </p>
        </div>

        <!-- Buy CTA + Actions -->
        <div class="brain-score__buy-cta">
          <a class="brain-score__btn brain-score__btn--buy" href="https://drinkkenetik.com/collections/all"><span>Buy Kenetik</span></a>
        </div>

        <div class="brain-score__results-actions">
          <button class="brain-score__btn brain-score__btn--secondary" id="dsst-retest" type="button"><span>Take It Again</span></button>
          <a class="brain-score__btn brain-score__btn--secondary" href="stroop.html"><span>Try the Stroop Color Test</span></a>
        </div>
      </div>
    </div>

  </div>
</section>

<script>
(function() {
  'use strict';

  /* ===== DSST CONFIGURATION ===== */
  var SYMBOLS = ['▲', '◆', '●', '■', '✦', '★', '▼', '⬟', '◎'];

  var CONFIG = {
    testDuration: 90,
    feedbackDuration: 300,
    digits: [1, 2, 3, 4, 5, 6, 7, 8, 9]
  };

  var symbolOrder = SYMBOLS.slice();
  for (var si = symbolOrder.length - 1; si > 0; si--) {
    var sj = Math.floor(Math.random() * (si + 1));
    var tmp = symbolOrder[si];
    symbolOrder[si] = symbolOrder[sj];
    symbolOrder[sj] = tmp;
  }

  var digitSymbolMap = {};
  CONFIG.digits.forEach(function(d, i) {
    digitSymbolMap[d] = symbolOrder[i];
  });

  /* ===== STATE ===== */
  var state = {
    name: '',
    email: '',
    phone: '',
    useCase: '',
    otherText: '',
    ageBracket: '',
    results: [],
    currentDigit: 0,
    testActive: false,
    trialStart: 0,
    timeRemaining: CONFIG.testDuration,
    timerInterval: null,
    liveCorrect: 0
  };

  /* ===== DOM REFS ===== */
  var screens = {
    intro: document.getElementById('dsst-intro'),
    countdown: document.getElementById('dsst-countdown'),
    test: document.getElementById('dsst-test'),
    results: document.getElementById('dsst-results')
  };

  var els = {
    startBtn: document.getElementById('dsst-start-btn'),
    nameInput: document.getElementById('dsst-name'),
    emailInput: document.getElementById('dsst-email'),
    phoneInput: document.getElementById('dsst-phone'),
    useCases: document.getElementById('dsst-use-cases'),
    otherWrap: document.getElementById('dsst-other-wrap'),
    otherText: document.getElementById('dsst-other-text'),
    ageSelect: document.getElementById('dsst-age'),
    welcomeBack: document.getElementById('dsst-welcome-back'),
    welcomeName: document.getElementById('dsst-welcome-name'),
    clearUserBtn: document.getElementById('dsst-clear-user'),
    countdownNum: document.getElementById('dsst-countdown-num'),
    key: document.getElementById('dsst-key'),
    promptDigit: document.getElementById('dsst-prompt-digit'),
    responses: document.getElementById('dsst-responses'),
    feedback: document.getElementById('dsst-feedback'),
    timer: document.getElementById('dsst-timer'),
    timerFill: document.getElementById('dsst-timer-fill'),
    liveScore: document.getElementById('dsst-live-score'),
    score: document.getElementById('dsst-score'),
    completed: document.getElementById('dsst-completed'),
    accuracy: document.getElementById('dsst-accuracy'),
    avgTime: document.getElementById('dsst-avg-time'),
    insightText: document.getElementById('dsst-insight-text'),
    retestSection: document.getElementById('dsst-retest-section'),
    retestBtn: document.getElementById('dsst-retest')
  };

  function showScreen(name) {
    Object.keys(screens).forEach(function(key) {
      screens[key].classList.remove('brain-score__screen--active');
    });
    screens[name].classList.add('brain-score__screen--active');
  }

  /* ===== RETURNING USER (localStorage) ===== */
  var STORED_USER_KEY = 'kenetik_bs_user';

  function getStoredUser() {
    try {
      var data = localStorage.getItem(STORED_USER_KEY);
      return data ? JSON.parse(data) : null;
    } catch(e) { return null; }
  }

  function storeUser() {
    try {
      localStorage.setItem(STORED_USER_KEY, JSON.stringify({
        name: state.name,
        email: state.email,
        phone: state.phone,
        useCase: state.useCase,
        otherText: state.otherText,
        ageBracket: state.ageBracket
      }));
    } catch(e) {}
  }

  function clearStoredUser() {
    try { localStorage.removeItem(STORED_USER_KEY); } catch(e) {}
  }

  function loadStoredUser() {
    var stored = getStoredUser();
    if (!stored || !stored.name || !stored.email) return;

    els.nameInput.value = stored.name;
    els.emailInput.value = stored.email;
    els.phoneInput.value = stored.phone || '';

    if (stored.useCase) {
      state.useCase = stored.useCase;
      var matchingLabel = els.useCases.querySelector('[data-value="' + stored.useCase + '"]');
      if (matchingLabel) {
        matchingLabel.classList.add('selected');
        var radio = matchingLabel.querySelector('input');
        if (radio) radio.checked = true;
      }
      if (stored.useCase === 'other' && stored.otherText) {
        els.otherWrap.style.display = 'block';
        els.otherText.value = stored.otherText;
        state.otherText = stored.otherText;
      }
    }

    if (stored.ageBracket) {
      els.ageSelect.value = stored.ageBracket;
      state.ageBracket = stored.ageBracket;
    }

    els.welcomeBack.style.display = 'flex';
    els.welcomeName.textContent = stored.name;
    validateForm();
  }

  els.clearUserBtn.addEventListener('click', function() {
    clearStoredUser();
    els.nameInput.value = '';
    els.emailInput.value = '';
    els.phoneInput.value = '';
    els.otherText.value = '';
    els.otherWrap.style.display = 'none';
    els.ageSelect.selectedIndex = 0;
    state.useCase = '';
    state.otherText = '';
    state.ageBracket = '';
    var labels = els.useCases.querySelectorAll('.brain-score__use-case');
    labels.forEach(function(l) { l.classList.remove('selected'); });
    els.welcomeBack.style.display = 'none';
    els.startBtn.disabled = true;
  });

  loadStoredUser();

  /* ===== BUILD REFERENCE KEY & RESPONSE GRID ===== */
  function buildUI() {
    els.key.innerHTML = '';
    CONFIG.digits.forEach(function(d) {
      var pair = document.createElement('div');
      pair.className = 'dsst__key-pair';
      pair.innerHTML = '<div class="dsst__key-digit">' + d + '</div>' +
                       '<div class="dsst__key-symbol">' + digitSymbolMap[d] + '</div>';
      els.key.appendChild(pair);
    });

    var responseOrder = CONFIG.digits.slice();
    for (var ri = responseOrder.length - 1; ri > 0; ri--) {
      var rj = Math.floor(Math.random() * (ri + 1));
      var rtmp = responseOrder[ri];
      responseOrder[ri] = responseOrder[rj];
      responseOrder[rj] = rtmp;
    }
    els.responses.innerHTML = '';
    responseOrder.forEach(function(d) {
      var btn = document.createElement('button');
      btn.className = 'dsst__response-btn';
      btn.type = 'button';
      btn.setAttribute('data-digit', String(d));
      btn.textContent = digitSymbolMap[d];
      btn.addEventListener('touchstart', function(ev) {
        ev.preventDefault();
        handleResponse(d);
      }, { passive: false });
      els.responses.appendChild(btn);
    });
  }

  buildUI();

  /* ===== FORM VALIDATION ===== */
  var useCaseLabels = els.useCases.querySelectorAll('.brain-score__use-case');
  useCaseLabels.forEach(function(label) {
    label.addEventListener('click', function() {
      useCaseLabels.forEach(function(l) { l.classList.remove('selected'); });
      label.classList.add('selected');
      state.useCase = label.getAttribute('data-value');
      if (state.useCase === 'other') {
        els.otherWrap.style.display = 'block';
        els.otherText.focus();
      } else {
        els.otherWrap.style.display = 'none';
      }
      validateForm();
    });
  });

  els.otherText.addEventListener('input', function() {
    state.otherText = els.otherText.value.trim();
    validateForm();
  });

  els.ageSelect.addEventListener('change', function() {
    state.ageBracket = els.ageSelect.value;
    validateForm();
  });

  function validateForm() {
    var nameValid = els.nameInput.value.trim().length > 0;
    var emailValid = els.emailInput.value.trim().match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/);
    var useCaseValid = state.useCase !== '' && (state.useCase !== 'other' || els.otherText.value.trim().length > 0);
    var ageValid = state.ageBracket !== '';
    els.startBtn.disabled = !(nameValid && emailValid && useCaseValid && ageValid);
  }

  els.nameInput.addEventListener('input', validateForm);
  els.emailInput.addEventListener('input', validateForm);

  /* ===== START TEST ===== */
  els.startBtn.addEventListener('click', function() {
    state.name = els.nameInput.value.trim();
    state.email = els.emailInput.value.trim();
    state.phone = els.phoneInput.value.trim();
    state.otherText = els.otherText.value.trim();
    state.ageBracket = els.ageSelect.value;
    state.results = [];
    state.liveCorrect = 0;
    state.timeRemaining = CONFIG.testDuration;

    storeUser();

    showScreen('countdown');
    runCountdown();
  });

  function runCountdown() {
    var count = 3;
    els.countdownNum.textContent = count;
    var interval = setInterval(function() {
      count--;
      if (count > 0) {
        els.countdownNum.textContent = count;
      } else {
        clearInterval(interval);
        showScreen('test');
        state.testActive = true;
        startTimer();
        presentDigit();
      }
    }, 1000);
  }

  /* ===== TIMER ===== */
  function startTimer() {
    els.timer.textContent = state.timeRemaining;
    els.timerFill.style.width = '100%';
    els.liveScore.textContent = '0';

    state.timerInterval = setInterval(function() {
      state.timeRemaining--;
      els.timer.textContent = state.timeRemaining;
      els.timerFill.style.width = (state.timeRemaining / CONFIG.testDuration * 100) + '%';
      if (state.timeRemaining <= 10) els.timer.classList.add('dsst__timer--urgent');
      if (state.timeRemaining <= 0) endTest();
    }, 1000);
  }

  /* ===== PRESENT DIGIT ===== */
  function pickRandomDigit() {
    return CONFIG.digits[Math.floor(Math.random() * CONFIG.digits.length)];
  }

  function presentDigit() {
    if (!state.testActive) return;
    state.currentDigit = pickRandomDigit();
    els.promptDigit.textContent = state.currentDigit;
    els.feedback.innerHTML = '&nbsp;';
    state.trialStart = performance.now();
  }

  /* ===== HANDLE RESPONSE ===== */
  function handleResponse(selectedDigit) {
    if (!state.testActive) return;

    var rt = performance.now() - state.trialStart;
    var correct = selectedDigit === state.currentDigit;

    state.results.push({
      digit: state.currentDigit,
      expectedSymbol: digitSymbolMap[state.currentDigit],
      selectedDigit: selectedDigit,
      correct: correct,
      rt: Math.round(rt)
    });

    if (correct) {
      state.liveCorrect++;
      els.liveScore.textContent = state.liveCorrect;
    }

    els.feedback.textContent = correct ? 'Correct' : 'Incorrect';
    els.feedback.className = 'brain-score__feedback ' +
      (correct ? 'brain-score__feedback--correct' : 'brain-score__feedback--incorrect');

    setTimeout(function() { presentDigit(); }, CONFIG.feedbackDuration);
  }

  els.responses.addEventListener('click', function(e) {
    var btn = e.target.closest('.dsst__response-btn');
    if (btn) handleResponse(parseInt(btn.getAttribute('data-digit'), 10));
  });

  els.responses.addEventListener('touchend', function(e) { e.preventDefault(); });

  document.addEventListener('keydown', function(e) {
    if (!state.testActive) return;
    var num = parseInt(e.key, 10);
    if (num >= 1 && num <= 9) handleResponse(num);
  });

  /* ===== SCORE HISTORY (localStorage) ===== */
  var HISTORY_KEY_PREFIX = 'kenetik_dsst_';
  var MAX_HISTORY = 12;

  function hashEmail(email) {
    var hash = 0;
    for (var i = 0; i < email.length; i++) {
      hash = ((hash << 5) - hash) + email.charCodeAt(i);
      hash |= 0;
    }
    return Math.abs(hash).toString(36);
  }

  function getHistory(email) {
    try {
      var key = HISTORY_KEY_PREFIX + hashEmail(email);
      var data = localStorage.getItem(key);
      return data ? JSON.parse(data) : [];
    } catch(e) { return []; }
  }

  function saveToHistory(email, entry) {
    try {
      var key = HISTORY_KEY_PREFIX + hashEmail(email);
      var history = getHistory(email);
      history.push(entry);
      if (history.length > MAX_HISTORY) history = history.slice(history.length - MAX_HISTORY);
      localStorage.setItem(key, JSON.stringify(history));
      return history;
    } catch(e) { return [entry]; }
  }

  function renderHistory(history) {
    var container = document.getElementById('dsst-history');
    var chart = document.getElementById('dsst-history-chart');
    var labels = document.getElementById('dsst-history-labels');
    var summary = document.getElementById('dsst-history-summary');

    if (!history || history.length < 2) { container.style.display = 'none'; return; }

    container.style.display = 'block';
    var chartHeight = 120;
    var count = history.length;
    chart.innerHTML = '';
    labels.innerHTML = '';

    var svgNS = 'http://www.w3.org/2000/svg';
    var svg = document.createElementNS(svgNS, 'svg');
    svg.setAttribute('class', 'brain-score__history-svg');
    svg.setAttribute('viewBox', '0 0 100 100');
    svg.setAttribute('preserveAspectRatio', 'none');
    svg.style.cssText = 'position:absolute;top:0;left:0;width:100%;height:' + chartHeight + 'px;';

    var polyline = document.createElementNS(svgNS, 'polyline');
    var pointsStr = '';

    for (var i = 0; i < count; i++) {
      var entry = history[i];
      var x = count > 1 ? (i / (count - 1)) * 100 : 50;
      var y = 100 - entry.score;
      pointsStr += x + ',' + y + ' ';

      var dot = document.createElement('div');
      dot.className = 'brain-score__history-dot';
      dot.style.left = x + '%';
      dot.style.bottom = entry.score + '%';
      var scoreLbl = document.createElement('div');
      scoreLbl.className = 'brain-score__history-dot-score';
      scoreLbl.textContent = entry.score;
      dot.appendChild(scoreLbl);
      chart.appendChild(dot);

      var dateLbl = document.createElement('div');
      dateLbl.className = 'brain-score__history-date';
      dateLbl.style.left = x + '%';
      dateLbl.textContent = formatHistoryDate(entry.date);
      labels.appendChild(dateLbl);
    }

    polyline.setAttribute('points', pointsStr.trim());
    polyline.setAttribute('fill', 'none');
    polyline.setAttribute('stroke', 'url(#dsst-grad)');
    polyline.setAttribute('stroke-width', '2');
    polyline.setAttribute('vector-effect', 'non-scaling-stroke');

    var defs = document.createElementNS(svgNS, 'defs');
    var grad = document.createElementNS(svgNS, 'linearGradient');
    grad.setAttribute('id', 'dsst-grad');
    var stop1 = document.createElementNS(svgNS, 'stop');
    stop1.setAttribute('offset', '0%');
    stop1.setAttribute('stop-color', '#E84B63');
    var stop2 = document.createElementNS(svgNS, 'stop');
    stop2.setAttribute('offset', '100%');
    stop2.setAttribute('stop-color', '#F4B341');
    grad.appendChild(stop1);
    grad.appendChild(stop2);
    defs.appendChild(grad);
    svg.appendChild(defs);
    svg.appendChild(polyline);
    chart.appendChild(svg);

    var first = history[0].score;
    var latest = history[history.length - 1].score;
    var diff = latest - first;

    if (diff > 0) {
      summary.textContent = 'Your processing speed has improved by ' + diff + ' points since your first test. That improvement reflects faster symbol matching and stronger working memory under pressure.';
    } else if (diff < 0) {
      summary.textContent = 'Your score is ' + Math.abs(diff) + ' points below your first test. Time of day, fatigue, and cognitive load all influence processing speed.';
    } else {
      summary.textContent = 'Your processing speed is holding steady. Consistency under time pressure is a strong sign of reliable cognitive function.';
    }
  }

  function formatHistoryDate(dateStr) {
    try {
      var d = new Date(dateStr);
      var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      return months[d.getMonth()] + ' ' + d.getDate();
    } catch(e) { return ''; }
  }

  /* ===== END TEST & SCORING ===== */
  function endTest() {
    state.testActive = false;
    clearInterval(state.timerInterval);

    var totalAttempted = state.results.length;
    var correct = state.results.filter(function(r) { return r.correct; });
    var correctCount = correct.length;
    var accuracyPct = totalAttempted > 0 ? Math.round((correctCount / totalAttempted) * 100) : 0;
    var avgRT = correct.length > 0
      ? Math.round(correct.reduce(function(sum, r) { return sum + r.rt; }, 0) / correct.length) : 0;

    var throughputScore = Math.max(0, Math.min(100, ((correctCount - 15) / 45) * 100));
    var accuracyScore = accuracyPct;
    var speedScore = Math.max(0, Math.min(100, 100 - ((avgRT - 800) / 17)));

    var brainScore = Math.round(
      (throughputScore * 0.50) + (accuracyScore * 0.25) + (speedScore * 0.25)
    );
    brainScore = Math.max(0, Math.min(100, brainScore));

    els.score.textContent = brainScore;
    els.completed.textContent = correctCount + '/' + totalAttempted;
    els.accuracy.textContent = accuracyPct + '%';
    els.avgTime.textContent = avgRT + 'ms';

    document.getElementById('dsst-perf-fill').style.width = brainScore + '%';

    var insightText = '';
    if (brainScore >= 85) {
      insightText = 'Exceptional processing speed. You matched symbols quickly and accurately under time pressure, which requires strong working memory and rapid visual scanning. This is the kind of sustained cognitive throughput that separates peak performers.';
    } else if (brainScore >= 70) {
      insightText = 'Solid processing speed with room to build. Your brain handled the symbol matching well, though faster recall of the digit-symbol pairings would push your score higher. Working memory and processing speed both respond to consistent cognitive routines.';
    } else if (brainScore >= 50) {
      insightText = 'Your processing speed is in the typical range. The DSST is specifically designed to detect changes in cognitive processing. Factors like sleep quality, hydration, and mental fatigue all play a role. Try retesting at your peak focus time.';
    } else {
      insightText = 'Your processing speed has room to improve. This is often the first measure to respond to changes in sleep, stress, and sustained attention. Retesting at different times of day can reveal your natural cognitive rhythm.';
    }
    els.insightText.textContent = insightText;

    var scienceFacts = [
      'The DSST is the exact test used in a clinical study where BHB ketone supplementation improved processing speed and increased cerebral blood flow in adults. (Walsh et al., 2021)',
      'In a controlled study, ketones increased cerebral blood flow by approximately 30%, delivering more oxygen and fuel to the brain regions responsible for processing speed. (Svart et al., 2018)',
      'After consuming one bottle of Kenetik, qEEG brain mapping showed alpha wave power increased 18% and gamma wave power increased 16%. Alpha waves are associated with calm focus; gamma waves with higher-order processing. (Machado et al., 2022)',
      'Processing speed is one of the first cognitive functions to decline with age. Brain imaging research identified a midlife "critical window" where metabolic interventions like ketones may have the greatest impact on brain network stability. (Antal et al., 2025; Mujica-Parodi et al., 2020)',
      'Exogenous ketones increased circulating dopamine and maintained mental alertness during exhaustive physical and cognitive effort, supporting the brain when it needs fuel most. (Poffé et al., 2023)',
      'In a 6-month clinical trial, participants taking a ketogenic supplement showed improvements in memory, language, and executive function, with benefits directly correlated to blood ketone levels. (Fortier et al., 2021)',
      'Your brain consumes about 20% of your total energy despite being only 2% of your body weight. Ketones provide an efficient alternative fuel source that crosses the blood-brain barrier directly.'
    ];
    var factIndex = Math.floor(Math.random() * scienceFacts.length);
    document.getElementById('dsst-science-fact-text').textContent = scienceFacts[factIndex];
    var shownFact = scienceFacts[factIndex];

    if (state.phone) els.retestSection.style.display = 'block';

    showScreen('results');

    var historyEntry = {
      score: brainScore, completed: correctCount, accuracy: accuracyPct, avgRT: avgRT,
      date: new Date().toISOString()
    };
    var allHistory = saveToHistory(state.email, historyEntry);
    renderHistory(allHistory);

    submitResults(brainScore, correctCount, totalAttempted, accuracyPct, avgRT, shownFact);
  }

  /* ===== DATA SUBMISSION ===== */
  function submitResults(score, correctCount, totalAttempted, accuracy, avgRT, shownFact) {
    var useCaseValue = state.useCase === 'other' ? 'other: ' + state.otherText : state.useCase;

    var payload = {
      name: state.name, email: state.email, phone: state.phone,
      use_case: useCaseValue, age_bracket: state.ageBracket,
      brain_score: score, correct_count: correctCount,
      total_attempted: totalAttempted, accuracy: accuracy,
      avg_reaction_time: avgRT, test_type: 'dsst',
      timestamp: new Date().toISOString(), source: 'kenetik-brain-score-dsst'
    };

    if (window.Shopify && window.Shopify.analytics) {
      try { window.Shopify.analytics.publish('brain_score_completed', payload); } catch(e) {}
    }

    if (window._learnq) {
      try {
        var perfTier = score >= 85 ? 'exceptional' : score >= 70 ? 'strong' : score >= 50 ? 'typical' : 'developing';
        var speedTier = avgRT < 1000 ? 'fast' : avgRT < 1500 ? 'moderate' : 'deliberate';

        window._learnq.push(['identify', {
          '$email': state.email,
          '$first_name': state.name,
          '$phone_number': state.phone || undefined,
          'Brain Score DSST': score,
          'Brain Score Use Case': useCaseValue,
          'Brain Score Age Bracket': state.ageBracket,
          'DSST Correct Count': correctCount,
          'DSST Accuracy': accuracy,
          'DSST Avg RT': avgRT,
          'DSST Performance Tier': perfTier,
          'DSST Speed Tier': speedTier,
          'Brain Score Test Date': new Date().toISOString()
        }]);
        window._learnq.push(['track', 'Brain Score Completed', {
          'Test Type': 'DSST', 'Score': score,
          'Correct Count': correctCount, 'Total Attempted': totalAttempted,
          'Accuracy': accuracy, 'Avg Reaction Time': avgRT,
          'Use Case': useCaseValue, 'Age Bracket': state.ageBracket,
          'Performance Tier': perfTier, 'Speed Tier': speedTier,
          'Science Fact Shown': shownFact, 'Test Date': new Date().toISOString()
        }]);
      } catch(e) {}
    }

    console.log('[Kenetik Brain Score DSST] Results:', JSON.stringify(payload, null, 2));
  }

  /* ===== RETEST (skip form) ===== */
  els.retestBtn.addEventListener('click', function() {
    for (var si = symbolOrder.length - 1; si > 0; si--) {
      var sj = Math.floor(Math.random() * (si + 1));
      var tmp = symbolOrder[si];
      symbolOrder[si] = symbolOrder[sj];
      symbolOrder[sj] = tmp;
    }
    CONFIG.digits.forEach(function(d, i) { digitSymbolMap[d] = symbolOrder[i]; });
    buildUI();

    state.results = [];
    state.liveCorrect = 0;
    state.timeRemaining = CONFIG.testDuration;
    els.timer.classList.remove('dsst__timer--urgent');
    showScreen('countdown');
    runCountdown();
  });

})();
</script>


</body>
</html>